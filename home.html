<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome Home</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .organization, .individual {
            display: none;
        }
    </style>
</head>
<body>
    <h1 id="welcome-message">Welcome Home</h1>
    <div class="organization">
        <h2>Organization Dashboard</h2>
        <p>Welcome, Organization! Manage your resources here.</p>
    </div>
    <div class="individual">
        <h2>Individual Dashboard</h2>
        <p>Welcome, Individual! Explore your personalized content.</p>
    </div>

    <script>
        // Fetch user details from the backend
        document.addEventListener("DOMContentLoaded", async () => {
            const token = localStorage.getItem('token'); // Assume token is stored in localStorage
            if (!token) {
                window.location.href = 'index.html'; // Redirect to login if no token
                return;
            }

            try {
                const response = await fetch('http://localhost:5000/user', {
                    headers: {
                        Authorization: `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch user details');
                }

                const user = await response.json();

                // Check if the user has a valid role
                if (!user.role || (user.role !== "Organization" && user.role !== "Individual")) {
                    window.location.href = 'index.html'; // Redirect if no valid role
                    return;
                }

                const welcomeMessage = document.getElementById("welcome-message");

                if (user.role === "Organization") {
                    document.querySelector(".organization").style.display = "block";
                    welcomeMessage.textContent = `Welcome, ${user.name} (Organization)!`;
                } else if (user.role === "Individual") {
                    document.querySelector(".individual").style.display = "block";
                    welcomeMessage.textContent = `Welcome, ${user.name} (Individual)!`;
                }
            } catch (error) {
                console.error(error);
                window.location.href = 'index.html'; // Redirect to login on error
            }
        });
    </script>
</body>
</html>